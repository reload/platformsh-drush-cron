#!/usr/bin/env sh

set -e

if test -z "$PROJECT"; then
    echo "\$PROJECT is empty"
    exit 1
fi

if test -z "$PLATFORMSH_CLI_TOKEN"; then
    echo "\$PLATFORMSH_CLI_TOKEN is empty"
    exit 2
fi

for environment in $(platform environment:list --no-inactive --yes --pipe --project="$PROJECT"); do
    platform "environment:${COMMAND:-drush}" --yes --project="$PROJECT" --environment="$environment" "${ARGUMENTS:-cron}"
done
